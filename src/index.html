<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';"/>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="./js/libs/jquery-3.6.0.min.js"></script>
    <style>
        table#trigger-overview {
            width: 500px
        }
        table#trigger-overview thead th {
            text-align: left;
            font-weight: bold;
        }
    </style>
</head>
<body style="background: white;">
<h1>Hello World!</h1>
<button onclick="doRequest()">Do Request</button>
<form>
    <label for="trigger-name">Value:</label><br/>
    <input type="text" id="trigger-name" name="name"><br/>
    <label for="trigger-id">ID: </label><br/>
    <input type="text" id="trigger-id" name="id"><br/>
    <label for="field-name">Field: </label><br/>
    <input type="text" value="name" id="field-name" name="field"><br/>

    <button type="submit" id="new-trigger">Add</button>
    <button type="submit" id="edit-trigger">Edit</button>
</form>
<table id="trigger-overview">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Enabled</th>
        <th>Looping</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
</table>
</body>
<script>
    $(document).on('click', '#edit-trigger', function (e) {
        e.preventDefault()
        let data = {}
        data[$('#field-name').val()] = $('#trigger-name').val()

        $.ajax({
            type: "PUT",
            url: "http://localhost:5000/triggers/" +  $('#trigger-id').val(),
            data: data,
            dataType: "json"
        }).done(function () {
            doRequest()
        });
    })

    $(document).on('click', '#new-trigger', function(e) {
        e.preventDefault()

        $.ajax({
            type: "POST",
            url: "http://localhost:5000/triggers",
            data: {
                name: $('#trigger-name').val()
            },
            dataType: "json"
        }).done(function () {
            doRequest()
        });
    })

    function doRequest() {
        $.ajax({
            url: 'http://localhost:5000/triggers',
            dataType: "json"
        }).done(function (data) {
            let triggers = data['triggers']
            let tbody = $('#trigger-overview tbody')
            tbody.html('')

            for (let trigger of triggers) {
                let tr = $('<tr></tr>')
                let result = ""
                for (let key of ['id', 'name','enabled', 'looping', 'description']) {
                    result += `<td>${trigger[key]}</td>`
                }
                tr.html(result)
                tbody.append(tr)
            }
        });
    }
</script>
</html>
